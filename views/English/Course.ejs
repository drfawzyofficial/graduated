<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags(utf-8) & (viewport) -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/images/System/Logo/logo.png" />
    <!-- Typeahead CSS -->
    <link rel="stylesheet" href="/assets/css/typeahead.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="/assets/css/animate.css" />
    <!-- Hover CSS -->
    <link rel="stylesheet" href="/assets/css/hover.css" />
    <!-- VideoJS CSS -->
    <link href="https://vjs.zencdn.net/7.8.4/video-js.css" rel="stylesheet" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <!-- Profile CSS -->
    <link rel="stylesheet" href="/assets/css/profile.css" />
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <title>
        <%= user.fullname %>
    </title>
</head>
<style>
    .cancelNotificationSuccess,
    .cancelNotificationError {
        background-color: rgba(0, 0, 0, 0.5);
        position: absolute;
        top: 5px;
        right: 5px;
        height: 25px;
        width: 25px;
        ;
        text-align: center;
        line-height: 25px;
        border-radius: 50%;
        cursor: pointer;
    }

    .notificationSuccess,
    .notificationError {
        position: absolute;
        bottom: 25px;
        left: 25px;
        bottom: 25px;
        border-radius: 15px;
        position: fixed;
        width: 275px;
        z-index: 5000;
        background-color: rgb(76, 175, 76);
        display: none;
    }

    .notificationSuccess {
        background-color: rgb(44, 150, 68);
    }

    .notificationError {
        background-color: #c24949;
    }
</style>

<body style="position: absolute; background-color: rgb(210, 228, 255) !important">
    <!-- Navigation Bar Content -->
    <%- include('../partials/English/Header') -%>
    <!-- Navigation Bar Content -->
    <div class="container-fluid py-3 " style="background-color: #3a4352; margin-top: 77px">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="f-content text-white">
                        <h5 class="m-0"><strong>The Course <%= course.coursename %> is teached by
                                <%= course.instructorID.fullname %></strong></h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid py-5" style="background-color: #29303B">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="content text-white">
                        <h3>Course named as <%= course.coursename %></h3>
                        <p style="font-size: 25px" class="mb-0"><%= course.coursename %> Course is now avialable with
                            Price <%= course.courseprice %> and number of limited users is <%= course.courselimited %>
                            at <%= course.centerlocation %> <%=  course.users.length%> </p>
                        <div class="d-flex mt-3">
                            <span class="courseprice badge badge-warning p-2 d-flex align-items-center">Course Price is
                                <%= course.courseprice %>$</span>
                            <span class="users badge badge-warning p-2 d-flex align-items-center ml-3">Enrolled Users is
                                <%= course.users.length %></span>
                            <span class="courselimited badge badge-warning p-2 d-flex align-items-center ml-3">Course
                                limited is <%= course.courselimited %></span>
                        </div>
                        <div class="d-flex mt-3">
                            <span class="courseprice badge badge-danger p-2 d-flex align-items-center">Address
                                <%= course.centerplace %></span>
                            <span class="users badge badge-danger p-2 d-flex align-items-center ml-3">Start
                                <%= moment(course.coursestart).format('DD-MMM-YYYY') %></span>
                            <span class="users badge badge-danger p-2 d-flex align-items-center ml-2">End
                                <%= moment(course.courseend).format('DD-MMM-YYYY')  %></span>
                        </div>
                        <div class="d-flex mt-3">
                            <div class="mr-2">Pay with</div>
                            <div id="paypal-button"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-12 mt-2 mt-md-0">
                    <div class="content bg-white rounded-lg shadow-sm h-100 w-100">
                        <div class="sectionForVideo w-100 w-100">
                            <video id="my-video" class="video-js" controls preload="auto" height="264" data-setup="{}"
                                style="max-width: 100%">
                                <source src="/assets/coursevideos/<%= course.coursevideo %>" type="video/mp4" />
                                <p class="vjs-no-js">
                                    To view this video please enable JavaScript, and consider
                                    upgrading to a
                                    web browser that
                                    <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5
                                        video</a>
                                </p>
                            </video>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid py-5 bg-light" style="background-color:rgb(210, 228, 255)">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="f-content bg-white p-3 shadow rounded-lg">
                        <h2><strong><span>About the instructor</span></strong></h2>
                        <div class="d-flex justify-content-between mt-3">
                            <div class="left-content text-center" style="width: 250px">
                                <div class="forImage">
                                    <img class="shadow"
                                        style="height: 150px; width: 150px; border-radius: 100%; border: 2px solid #888"
                                        src="../assets/uploads/<%= course.instructorID.avatar %>" />
                                </div>
                                <div class="forFullname mt-1 text-center">
                                    <h5><strong><%= course.instructorID.fullname %></strong></h5>
                                </div>
                                <div class="forLocation mt-1">
                                    <span
                                        style="display: block; padding: 7px 15px; background-color:#ceebfd; border: 1px solid #81c8f5; color: #36779e; font-size: 14px; border-radius: 4px">Location
                                        is <%= course.instructorID.location %> <i class="far fa-compass"
                                            aria-hidden="true"></i></span>
                                </div>
                            </div>
                            <div class="right-content pl-2" style="width: calc(100% - 250px)">
                                <div class="forBio">
                                    <p class="lead"><%= course.instructorID.bio %></p>
                                </div>
                                <hr style="margin-top: 0">
                                <div class="forInquries mt-2">
                                    <ul class="list-group">
                                        <li class="list-group-item"><i class="fas fa-male text-info mx-2"></i>Phone
                                            number <%= course.instructorID.phone %></li>
                                        <li class="list-group-item"><i class="fas fa-venus text-warning mx-2"></i>Email
                                            <%= course.instructorID.email %></li>
                                        <li class="list-group-item"><i class="fas fa-gavel text-danger mx-2"></i>
                                            Facebook Username <%= course.instructorID.username %></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="f-content mt-3  bg-white p-3 shadow rounded-lg">
                        <h2><strong><span>About the Center Place</span></strong></h2>
                        <div class="d-flex">
                            <div class="forImage">
                                <img style="width: 250px; height: 200px"
                                    src="../assets/centerphotos/<%= course.centerphoto %>" />
                            </div>
                            <div class="bg-light forContent d-flex align-items-center pl-2"
                                style="width: calc(100% - 250px)">
                                <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Aliquam rem facere, ducimus
                                    dignissimos eligendi nihil temporibus sequi sed! Minus, nesciunt assumenda.
                                    Corrupti, distinctio unde repellendus alias enim molestiae itaque obcaecati?</p>
                            </div>
                        </div>
                    </div>
                    <div class="f-content mt-3  bg-white p-3 shadow rounded-lg">
                        <h2><strong><span>About the Course Content</span></strong></h2>
                        <div class="d-flex">
                            <div class="forImage d-flex align-items-center">
                                <img style="width: 250px; height: 200px"
                                    src="/assets/centerphotos/<%= course.centerphoto %>" />
                            </div>
                            <div class="bg-light forContent d-flex align-items-center pl-2"
                                style="width: calc(100% - 250px)">
                                <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Aut, amet soluta sequi
                                    omnis inventore placeat repellendus odio vitae officia nihil, explicabo quaerat
                                    ipsum repellat est ex minus, quos dignissimos? Ut.</p>
                                <button type="button" class="btn btn-info btn-sm" data-toggle="modal"
                                    data-target="#courseContent">
                                    <span class="word">Content</span>
                                    <span class="icon"><i class="fas fa-pen-nib"></i></span>
                                </button>
                                <!-- Modal -->
                                <div class="modal fade" id="courseContent" tabindex="-1" role="dialog"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><%= course.coursename %>
                                                    Course Content</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="ql-snow">
                                                    <div class="ql-editor">
                                                        <%- course.coursebio %>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="f-content mt-3 bg-white p-3 shadow rounded-lg">
                        <% if(course.users.includes(user.id)) { %>
                        <h2><strong><span>Give Feedback to this Course</span></strong></h2>
                        <form class="feedback" id="feedback" style="position: relative;">
                            <input type="hidden" id="courseID" value="<%= course._id %>"/>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-pen-nib"></i></span>
                                </div>
                                <textarea maxlength="255" style="height: 175px; resize: none; font-size: 15px"
                                    placeholder="Give feedback composed from 255 chars" id="comment" name="comment"
                                    class="form-control"></textarea>
                            </div>
                            <div id="starSystem" style="position: absolute; bottom: 8px; right: 100px;"></div>
                            <button type="submit" class="btn btn-warning btn-sm"
                                style="position: absolute; bottom: 8px; right: 10px;">Feedback</button>
                        </form>
                        <% } %>
                        <h5><strong><span>All made reviews by users that have experience with this
                                    course</span></strong></h5>
                        <div class="courseReviews" id="courseReviews">
                            <% reviews.forEach((review) => { %>
                            <div class="review d-flex mt-3 bg-light shadow-sm rounded-lg p-2">
                                <div class="forImage text-center">
                                    <img src="/assets/uploads/<%= review.userID.avatar %>"
                                        style="height: 80px; width: 80px; border-radius: 50%" />
                                    <h6 class="mt-1" style="font-size: 14px"><%= review.userID.fullname %></h6>
                                </div>
                                <div class="forReview d-flex justify-content-center flex-column" style="width: calc(100% - 80px)">
                                    <p> <%= review.comment %>
                                    </p>
                                    <div class="d-flex">
                                        <span class="badge badge-warning">Stars: <%= review.stars %></span>
                                        <span class="badge badge-primary ml-2">Date: <%= moment(review.Date).format('MMMM Do YYYY, h:mm:ss a') %></span>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- Notification -->
        <div class="notificationSuccess text-white shadow-lg p-3"></div>
        <div class="notificationError text-white shadow-lg p-3"></div>
        <!-- Notification -->
        <script src="https://kit.fontawesome.com/8c190c8b3a.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js "
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo "
            crossorigin="anonymous "></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js "
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1 "
            crossorigin="anonymous "></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js "
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM "
            crossorigin="anonymous "></script>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <script src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
        <script src="/assets/js/searchEngine.js"></script>
        <script src="//vjs.zencdn.net/7.3.0/video.min.js"></script>
        <script src="/assets/js/emotion-ratings.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
        <script>
            $(() => {

                $('#starSystem').emotionsRating({
                    emotions: ['star'],
                    bgEmotion: "star",
                    count: 5,
                    color: 'red',
                    emotionSize: 40,
                    inputName: "rating",
                });
                var socket = io()
                socket.emit("join", "<%= user.id %>");
                socket.on("courseData", data => {
                    $("#flashMessage").html(`
                <audio autoplay class="d-none">
                    <source src="../assets/sounds/notification.mp3" type="audio/mpeg">
                </audio>
                <strong>Important Notification!</strong><br> ${data.coursename} Course is created now. You can visit the course link on <a target="_blank" href="/course/${data.courseID}">Visit</a> </span>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                `).fadeIn(250).delay(5000).fadeOut(250);
                })

            })
        </script>

        <!-- PayPal -->
        <script src="https://www.paypalobjects.com/api/checkout.js"></script>
        <script>
            paypal.Button.render({
                env: 'sandbox',
                payment: (data, actions) => {
                    return actions.request.post('/course/createPayment', {
                        courseID: "<%= course._id %>"
                    })
                        .then((data) => {  
                            if(data.statusCode != 200) {
                                $(".notificationError")
                        .html(
                            `
 <div class="cancelNotificationError text-white" id="cancelNotificationError">x</div>
<audio autoplay class="d-none">
<source src="
/assets/sounds/notification.mp3" type="audio/mpeg">
</audio>
<h4 class="text-white">Notification</h4>
<p class="mb-0 text-white" style="font-size: 14px; color: white">${ data.msgUser}</p>
 `
                        )
                        .show(100)
                        .delay(5000)
                        .hide(100);
                            }  else {
                                return data.id
                                $(".notificationSuccess")
                        .html(
                            `
 <div class="cancelNotificationSuccess text-white" id="cancelNotificationSuccess">x</div>
<audio autoplay class="d-none">
<source src="
/assets/sounds/notification.mp3" type="audio/mpeg">
</audio>
<h4 class="text-white">Notification</h4>
<p class="mb-0 text-white" style="font-size: 14px">${ data.msgUser}</p>
 `
                        )
                        .show(100)
                        .delay(5000)
                        .hide(100);
                                
                            }
                           
                        });
                },
                onAuthorize: function (data, actions) {
                    return actions.request.post('/course/executePayment', {
                        courseID: "<%= course._id %>",
                        paymentID: data.paymentID
                    })
                    .then((data) => {  
                            if(data.statusCode != 200) {
                                $(".notificationError")
                        .html(
                            `
 <div class="cancelNotificationError text-white" id="cancelNotificationError">x</div>
<audio autoplay class="d-none">
<source src="
/assets/sounds/notification.mp3" type="audio/mpeg">
</audio>
<h4 class="text-white">Notification</h4>
<p class="mb-0 text-white" style="font-size: 14px; color: white">${ data.msgUser }</p>
 `
                        )
                        .show(100)
                        .delay(5000)
                        .hide(100);
                            }  else {
                                $(".notificationSuccess")
                        .html(
                            `
 <div class="cancelNotificationSuccess text-white" id="cancelNotificationSuccess">x</div>
<audio autoplay class="d-none">
<source src="
/assets/sounds/notification.mp3" type="audio/mpeg">
</audio>
<h4 class="text-white">Notification</h4>
<p class="mb-0 text-white" style="font-size: 14px">${ data.msgUser}</p>
 `
                        )
                        .show(100)
                        .delay(5000)
                        .hide(100);
                        setTimeout(() => {
                            location.reload(true);
                        }, 5000)
                            }
                           
                

                           
                        });
                }
            }, '#paypal-button');
        </script>
        <script>
            $(() => {
                $("#cancelNotification").click(() => {
                    $(".purchaseCompleted").hide(100);
                })
            })
        </script>
        <script>
            $(() => {
                function success(data) {
                    $(".notificationSuccess")
                        .html(
                            `
 <div class="cancelNotificationSuccess text-white" id="cancelNotificationSuccess">x</div>
<audio autoplay class="d-none">
<source src="
/assets/sounds/notification.mp3" type="audio/mpeg">
</audio>
<h4 class="text-white">Notification</h4>
<p class="mb-0 text-white" style="font-size: 14px">${ data.msgUser}</p>
 `
                        )
                        .show(100)
                        .delay(5000)
                        .hide(100);
                }
                function error(data) {
                    $(".notificationError")
                        .html(
                            `
 <div class="cancelNotificationError text-white" id="cancelNotificationError">x</div>
<audio autoplay class="d-none">
<source src="
/assets/sounds/notification.mp3" type="audio/mpeg">
</audio>
<h4 class="text-white">Notification</h4>
<p class="mb-0 text-white" style="font-size: 14px; color: white">${ data.msgUser}</p>
 `
                        )
                        .show(100)
                        .delay(5000)
                        .hide(100);
                }
                $("#feedback").submit((e) => {
                    e.preventDefault();
                    const requestOptions = {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            courseID: $("#courseID").val(),
                            comment: $("#comment").val(),
                            stars: Number($(".emoji-rating-emotion-container-starSystem").val())
                        })
                    }
                    fetch("/course/feedback", requestOptions)
                        .then((response) => {
                            return response.json();
                        })
                        .then((data) => {
                            if (data.statusCode != 200) {
                                error(data)
                            } else {
                            //     $("#courseReviews").append(`
                            //     <div class="review d-flex mt-3">
                            //     <div class="forImage text-center">
                            //         <img src="/assets/uploads/${ data.review.userID.avatar }"
                            //             style="height: 100px; width: 100px; border-radius: 50%" />
                            //         <h6 class="mt-1">${ data.review.userID.fullname }></h6>
                            //     </div>
                            //     <div class="forReview  pl-2" style="width: calc(100% - 100px)">
                            //         <p> ${ data.review.comment } 
                            //         </p>
                            //         <p>Stars: ${ data.review.stars }</p>
                            //         <p>Time: ${ moment(data.review.Date).format('MMMM Do YYYY, h:mm:ss a') }</p>
                            //     </div>
                            // </div>
                            //     `)
                                success(data);
                                setTimeout(() => {
                                    location.reload(true)
                                }, 5000)
                            }
                        })
                        .catch((error) => {
                            console.error("Error:", error);
                        });
                })

            })
        </script>

</body>

</html>